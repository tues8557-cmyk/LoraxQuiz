<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lorax Escape Room (Firebase Ver.)</title>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDZ840nxSnRHJRfRYA4jCUZWaofhmEb8-Q",
    authDomain: "loraxquiz.firebaseapp.com",
    projectId: "loraxquiz",
    storageBucket: "loraxquiz.firebasestorage.app",
    messagingSenderId: "447106004390",
    appId: "1:447106004390:web:963e9819ef81d642d84b67",
    measurementId: "G-6HH0GZQNE6"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);


        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.saveScore = async (name, time) => {
            try {
                await addDoc(collection(db, "scores"), {
                    name: name,
                    time: time,
                    date: new Date()
                });
                console.log("Score saved!");
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        };

        window.loadLeaderboard = async () => {
            const q = query(collection(db, "scores"), orderBy("time", "asc"), limit(30));
            const querySnapshot = await getDocs(q);
            const body = document.getElementById('leaderboard-body');
            body.innerHTML = "";
            let rank = 1;
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                body.innerHTML += `<tr><td>${rank++}</td><td>${data.name}</td><td>${data.time}s</td></tr>`;
            });
        };
    </script>

    <style>
        body { font-family: 'Arial', sans-serif; background-color: #e8f5e9; text-align: center; padding: 20px; }
        #game-container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .header-info { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 20px; color: #2e7d32; padding: 10px; border-bottom: 2px solid #eee; }
        .question { font-size: 1.2rem; margin-bottom: 20px; min-height: 80px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 15px; border: none; border-radius: 8px; cursor: pointer; background: #4caf50; color: white; font-size: 1rem; transition: 0.3s; }
        button:hover { background: #388e3c; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #penalty-msg { color: #d32f2f; font-weight: bold; height: 25px; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #f1f8e9; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="login-screen">
        <h1 style="color:#2e7d32;">ğŸŒ³ The Lorax Escape Room</h1>
        <p>ì¹œêµ¬ë“¤ê³¼ ê²½ìŸí•´ë³´ì„¸ìš”! ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:</p>
        <input type="text" id="nickname-input" placeholder="Nickname" style="padding:12px; width:70%; border:1px solid #ccc; border-radius:5px;">
        <br><br>
        <button onclick="startGame()" style="width:70%;">ê²Œì„ ì‹œì‘ (Start)</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="header-info">
            <span>ğŸ‘¤ <span id="display-name"></span></span>
            <span>â±ï¸ <span id="timer">0</span>s</span>
        </div>
        <div id="penalty-msg"></div>
        <div class="question" id="question-text"></div>
        <div class="options-grid" id="options-container"></div>
    </div>

    <div id="result-screen" class="hidden">
        <h2>ğŸ‰ íƒˆì¶œ ì„±ê³µ (Escaped!)</h2>
        <p>ë‹¹ì‹ ì˜ ê¸°ë¡: <span id="final-time" style="font-weight:bold; color:blue;"></span>ì´ˆ</p>
        <hr>
        <h3>ğŸ† ì‹¤ì‹œê°„ ìˆœìœ„í‘œ (Top 30)</h3>
        <table>
            <thead>
                <tr><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>ì‹œê°„</th></tr>
            </thead>
            <tbody id="leaderboard-body">
                <tr><td colspan="3">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
            </tbody>
        </table>
        <br>
        <button onclick="location.reload()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
    </div>
</div>

<script>
    const questions = [
        { qEn: "What is the name of the town?", qKo: "ë§ˆì„ì˜ ì´ë¦„ì€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["Thneedville", "Treeville", "Once-ler Town", "Lorax City"], answer: "Thneedville" },
        { qEn: "Who speaks for the trees?", qKo: "ëˆ„ê°€ ë‚˜ë¬´ë“¤ì„ ëŒ€ë³€í•˜ë‚˜ìš”?", options: ["The Lorax", "Ted", "The Once-ler", "Mr. O'Hare"], answer: "The Lorax" },
        { qEn: "What are the trees made of in Thneedville?", qKo: "ìŠ¤ë‹ˆë“œë¹Œì˜ ë‚˜ë¬´ë“¤ì€ ë¬´ì—‡ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‚˜ìš”?", options: ["Plastic/Inflatables", "Wood", "Metal", "Sugar"], answer: "Plastic/Inflatables" },
        { qEn: "Who is the villain who sells fresh air?", qKo: "ë§‘ì€ ê³µê¸°ë¥¼ íŒŒëŠ” ì•…ë‹¹ì€ ëˆ„êµ¬ì¸ê°€ìš”?", options: ["Aloysius O'Hare", "The Once-ler", "Ted", "Grammy Norma"], answer: "Aloysius O'Hare" },
        { qEn: "What are the colorful trees called?", qKo: "ìƒ‰ê¹”ì´ í™”ë ¤í•œ ì´ ë‚˜ë¬´ë“¤ì˜ ì´ë¦„ì€?", options: ["Truffula Trees", "Marshmallow Trees", "Fluffy Trees", "O'Hare Trees"], answer: "Truffula Trees" },
        { qEn: "What did the Once-ler knit?", qKo: "ì›ìŠ¬ëŸ¬ê°€ ëœ¬ê°œì§ˆë¡œ ë§Œë“  ê²ƒì€?", options: ["A Thneed", "A Sweater", "A Hat", "A Scarf"], answer: "A Thneed" },
        { qEn: "Who does Ted want to impress?", qKo: "í…Œë“œê°€ ì˜ ë³´ì´ê³  ì‹¶ì–´ í•˜ëŠ” ì‚¬ëŒì€?", options: ["Audrey", "His Mom", "The Lorax", "The Once-ler"], answer: "Audrey" },
        { qEn: "What color is the Lorax?", qKo: "ë¡œë ‰ìŠ¤ì˜ ìƒ‰ê¹”ì€?", options: ["Orange", "Yellow", "Pink", "Green"], answer: "Orange" },
        { qEn: "Where does the Once-ler live?", qKo: "ì›ìŠ¬ëŸ¬ëŠ” ì–´ë””ì— ì‚¬ë‚˜ìš”?", options: ["Outside of town", "In a bank", "Underground", "In a tree"], answer: "Outside of town" },
        { qEn: "What is the only thing left when the Lorax leaves?", qKo: "ë¡œë ‰ìŠ¤ê°€ ë– ë‚  ë•Œ ë‚¨ê¸´ ìœ ì¼í•œ ê²ƒì€?", options: ["A rock with 'UNLESS'", "A seed", "A Thneed", "A letter"], answer: "A rock with 'UNLESS'" },
        { qEn: "What animal lives in the water?", qKo: "ë¬¼ì†ì— ì‚¬ëŠ” ë™ë¬¼ì€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["Humming-Fish", "Swomee-Swans", "Bar-ba-loots", "Pikachu"], answer: "Humming-Fish" },
        { qEn: "What is the name of Ted's grandmother?", qKo: "í…Œë“œì˜ í• ë¨¸ë‹ˆ ì„±í•¨ì€?", options: ["Grammy Norma", "Aunt Grizelda", "Mrs. Wiggins", "Nana"], answer: "Grammy Norma" },
        { qEn: "What do Bar-ba-loots eat?", qKo: "ë°”ë°”ë£¨íŠ¸ë“¤ì€ ë¬´ì—‡ì„ ë¨¹ë‚˜ìš”?", options: ["Truffula Fruits", "Marshmallows", "Burgers", "Fish"], answer: "Truffula Fruits" },
        { qEn: "How much does the Once-ler charge for his story?", qKo: "ì›ìŠ¬ëŸ¬ëŠ” ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ëŠ” ëŒ€ê°€ë¡œ ë¬´ì—‡ì„ ë°›ë‚˜ìš”?", options: ["15 cents, a nail, and a snail", "Gold", "A Thneed", "Fresh Air"], answer: "15 cents, a nail, and a snail" },
        { qEn: "What did the Lorax try to do to the Once-ler's bed?", qKo: "ë¡œë ‰ìŠ¤ê°€ ì›ìŠ¬ëŸ¬ì˜ ì¹¨ëŒ€ë¥¼ ì–´ë–»ê²Œ í•˜ë ¤ í–ˆë‚˜ìš”?", options: ["Float it down the river", "Burn it", "Hide it", "Paint it"], answer: "Float it down the river" },
        { qEn: "What color are Truffula trees?", qKo: "íŠ¸ëŸ¬í”Œë¼ ë‚˜ë¬´ì˜ ìƒ‰ê¹”ì€?", options: ["Many colors", "Only Pink", "Only Green", "Black and White"], answer: "Many colors" },
        { qEn: "What does 'UNLESS' mean in the movie?", qKo: "'UNLESS'ì˜ ì˜ë¯¸ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", options: ["Someone must care", "It is impossible", "Stop cutting trees", "Forget it"], answer: "Someone must care" },
        { qEn: "What does Ted plant at the end?", qKo: "í…Œë“œê°€ ë§ˆì§€ë§‰ì— ì‹¬ì€ ê²ƒì€?", options: ["The last Truffula seed", "A Thneed", "A plastic tree", "A flower"], answer: "The last Truffula seed" },
        { qEn: "Who helps Ted escape Thneedville?", qKo: "í…Œë“œê°€ ìŠ¤ë‹ˆë“œë¹Œì„ íƒˆì¶œí•˜ë„ë¡ ë•ëŠ” ì¸ë¬¼ì€?", options: ["Grammy Norma", "His Mother", "His Brother", "No one"], answer: "Grammy Norma" },
        { qEn: "What happens at the very end?", qKo: "ì˜í™” ë§¨ ë§ˆì§€ë§‰ì— ì¼ì–´ë‚˜ëŠ” ì¼ì€?", options: ["The Lorax returns", "The Once-ler dies", "O'Hare wins", "The seed dies"], answer: "The Lorax returns" }
    ];

    let currentIdx = 0;
    let timerInterval;
    let seconds = 0;
    let nickname = "";

    function startGame() {
        nickname = document.getElementById('nickname-input').value.trim();
        if (!nickname) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        document.getElementById('display-name').innerText = nickname;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        
        timerInterval = setInterval(() => {
            seconds++;
            document.getElementById('timer').innerText = seconds;
        }, 1000);
        
        showQuestion();
    }

    function showQuestion() {
        if (currentIdx >= questions.length) return endGame();
        const q = questions[currentIdx];
        document.getElementById('question-text').innerHTML = `<strong>Q${currentIdx+1}: ${q.qEn}</strong><br><small>${q.qKo}</small>`;
        const container = document.getElementById('options-container');
        container.innerHTML = "";
        
        const shuffled = [...q.options].sort(() => Math.random() - 0.5);
        shuffled.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, q.answer);
            container.appendChild(btn);
        });
    }

    function checkAnswer(selected, correct) {
        if (selected === correct) {
            currentIdx++;
            showQuestion();
        } else {
            const btns = document.querySelectorAll('#options-container button');
            btns.forEach(b => b.disabled = true);
            let timeLeft = 10;
            const msg = document.getElementById('penalty-msg');
            const pInterval = setInterval(() => {
                msg.innerText = `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤! ${timeLeft}ì´ˆ ëŒ€ê¸°...`;
                timeLeft--;
                if (timeLeft < 0) {
                    clearInterval(pInterval);
                    msg.innerText = "";
                    btns.forEach(b => b.disabled = false);
                }
            }, 1000);
        }
    }

    async function endGame() {
        clearInterval(timerInterval);
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-time').innerText = seconds;
        
        await window.saveScore(nickname, seconds); // ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
        await window.loadLeaderboard(); // ìˆœìœ„í‘œ ê°±ì‹ 
    }
</script>
</body>
</html>
