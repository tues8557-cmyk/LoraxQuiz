<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lorax Escape Room - Global Ranking</title>
    
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDZ840nxSnRHJRfRYA4jCUZWaofhmEb8-Q",
    authDomain: "loraxquiz.firebaseapp.com",
    projectId: "loraxquiz",
    storageBucket: "loraxquiz.firebasestorage.app",
    messagingSenderId: "447106004390",
    appId: "1:447106004390:web:963e9819ef81d642d84b67",
    measurementId: "G-6HH0GZQNE6"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);


        // ì ìˆ˜ ì €ì¥ í•¨ìˆ˜
        window.saveScore = async (name, time) => {
            try {
                await addDoc(collection(db, "scores"), {
                    name: name,
                    time: time,
                    date: new Date()
                });
            } catch (e) { console.error("Error saving score: ", e); }
        };

        // ìˆœìœ„ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        window.loadLeaderboard = async () => {
            const q = query(collection(db, "scores"), orderBy("time", "asc"), limit(30));
            const querySnapshot = await getDocs(q);
            const bodies = document.querySelectorAll('.leaderboard-body');
            
            let tableHTML = "";
            let rank = 1;
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                tableHTML += `<tr><td>${rank++}</td><td>${data.name}</td><td>${data.time}s</td></tr>`;
            });

            bodies.forEach(body => {
                body.innerHTML = tableHTML || "<tr><td colspan='3'>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>";
            });
        };
    </script>

    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f1f8e9; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
        #game-container { width: 90%; max-width: 500px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); position: relative; }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .rank-icon { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; background: #fff; border: 2px solid #4caf50; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .rank-icon:hover { background: #e8f5e9; transform: scale(1.1); }
        
        h1 { color: #2e7d32; margin-top: 10px; font-size: 24px; }
        .header-info { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 15px; background: #f9f9f9; padding: 10px; border-radius: 10px; }

        /* ì…ë ¥ ë° ì„ íƒ */
        input, select { padding: 12px; width: 100%; box-sizing: border-box; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .mode-selection { margin: 15px 0; text-align: left; }
        
        /* ë²„íŠ¼ */
        button { padding: 15px; border: none; border-radius: 10px; cursor: pointer; background: #4caf50; color: white; font-size: 16px; width: 100%; font-weight: bold; transition: 0.2s; }
        button:hover { background: #388e3c; }
        button:disabled { background: #ccc; }

        /* í€´ì¦ˆ UI */
        .question { font-size: 18px; margin: 20px 0; line-height: 1.5; min-height: 80px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #penalty-msg { color: #d32f2f; font-weight: bold; height: 24px; margin-bottom: 10px; }

        /* ìˆœìœ„í‘œ í…Œì´ë¸” */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #f1f8e9; color: #2e7d32; }

        .hidden { display: none; }
        .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; border-radius: 20px; padding: 20px; box-sizing: border-box; overflow-y: auto; z-index: 10; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="login-screen">
        <div class="rank-icon" onclick="showGlobalRank()">ğŸ†</div>
        <h1>ğŸŒ³ The Lorax Escape</h1>
        <p>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
        
        <input type="text" id="nickname-input" placeholder="Your Nickname">
        
        <div class="mode-selection">
            <label><strong>ë¬¸ì œ ëª¨ë“œ ì„ íƒ (Mode):</strong></label>
            <select id="language-mode">
                <option value="EN">English Main (ì˜ì–´ ìœ„ì£¼)</option>
                <option value="KO">Korean Main (í•œêµ­ì–´ ìœ„ì£¼)</option>
            </select>
        </div>
        
        <button onclick="startGame()">ê²Œì„ ì‹œì‘ (Start Game)</button>
    </div>

    <div id="rank-modal" class="modal hidden">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h3>ğŸ† Global Top 30</h3>
            <span style="cursor:pointer; font-weight:bold;" onclick="closeRank()">[ë‹«ê¸°]</span>
        </div>
        <table>
            <thead><tr><th>Rank</th><th>Name</th><th>Time</th></tr></thead>
            <tbody class="leaderboard-body"></tbody>
        </table>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="header-info">
            <span>ğŸ‘¤ <span id="display-name"></span></span>
            <span>â±ï¸ <span id="timer">0</span>s</span>
        </div>
        <div id="penalty-msg"></div>
        <div class="question" id="question-text"></div>
        <div class="options-grid" id="options-container"></div>
    </div>

    <div id="result-screen" class="hidden">
        <h2>ğŸ‰ íƒˆì¶œ ì„±ê³µ!</h2>
        <p>ìµœì¢… ê¸°ë¡: <span id="final-time" style="color:red; font-weight:bold;"></span>ì´ˆ</p>
        <hr>
        <h3>ğŸ† ì‹¤ì‹œê°„ ì „ì²´ ìˆœìœ„</h3>
        <table>
            <thead><tr><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>ì‹œê°„</th></tr></thead>
            <tbody class="leaderboard-body"></tbody>
        </table>
        <br>
        <button onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
</div>

<script>
    const questions = [
        { qEn: "What is the name of the town?", qKo: "ë§ˆì„ì˜ ì´ë¦„ì€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["Thneedville", "Treeville", "Once-ler Town", "Lorax City"], answer: "Thneedville" },
        { qEn: "Who 'speaks for the trees'?", qKo: "ëˆ„ê°€ 'ë‚˜ë¬´ë“¤ì„ ëŒ€ë³€'í•˜ë‚˜ìš”?", options: ["The Lorax", "Ted", "The Once-ler", "Mr. O'Hare"], answer: "The Lorax" },
        { qEn: "What are the trees made of in the town?", qKo: "ë§ˆì„ì˜ ë‚˜ë¬´ë“¤ì€ ë¬´ì—‡ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‚˜ìš”?", options: ["Plastic", "Wood", "Metal", "Glass"], answer: "Plastic" },
        { qEn: "Who is the villain selling fresh air?", qKo: "ê³µê¸°ë¥¼ íŒŒëŠ” ì•…ë‹¹ì€ ëˆ„êµ¬ì¸ê°€ìš”?", options: ["Aloysius O'Hare", "The Once-ler", "Ted", "Grammy Norma"], answer: "Aloysius O'Hare" },
        { qEn: "What is the name of the colorful trees?", qKo: "ì•Œë¡ë‹¬ë¡í•œ ë‚˜ë¬´ë“¤ì˜ ì´ë¦„ì€?", options: ["Truffula Trees", "Marshmallow Trees", "O'Hare Trees", "Cotton Trees"], answer: "Truffula Trees" },
        { qEn: "What did the Once-ler invent?", qKo: "ì›ìŠ¬ëŸ¬ê°€ ë°œëª…í•œ ê²ƒì€?", options: ["A Thneed", "A Car", "A Tree", "A Drink"], answer: "A Thneed" },
        { qEn: "What is the Lorax's color?", qKo: "ë¡œë ‰ìŠ¤ì˜ ìƒ‰ê¹”ì€?", options: ["Orange", "Yellow", "Pink", "Green"], answer: "Orange" },
        { qEn: "What color are the Truffula trees?", qKo: "íŠ¸ëŸ¬í”Œë¼ ë‚˜ë¬´ì˜ ìƒ‰ê¹”ì€?", options: ["Many colors", "Only Pink", "Only Green", "Blue"], answer: "Many colors" },
        { qEn: "Where does the Once-ler live?", qKo: "ì›ìŠ¬ëŸ¬ëŠ” ì–´ë””ì— ì‚¬ë‚˜ìš”?", options: ["Outside of town", "In a bank", "Underground", "In the city"], answer: "Outside of town" },
        { qEn: "What does Ted want to find for Audrey?", qKo: "í…Œë“œê°€ ì˜¤ë“œë¦¬ë¥¼ ìœ„í•´ ì°¾ê³  ì‹¶ì€ ê²ƒì€?", options: ["A real tree", "A Thneed", "A ring", "Fresh air"], answer: "A real tree" },
        { qEn: "What animal lives in the water?", qKo: "ë¬¼ì†ì— ì‚¬ëŠ” ë…¸ë˜í•˜ëŠ” ë¬¼ê³ ê¸°ëŠ”?", options: ["Humming-Fish", "Swomee-Swans", "Bar-ba-loots", "Goldfish"], answer: "Humming-Fish" },
        { qEn: "What do Bar-ba-loots eat?", qKo: "ë°”ë°”ë£¨íŠ¸ë“¤ì€ ë¬´ì—‡ì„ ë¨¹ë‚˜ìš”?", options: ["Truffula Fruits", "Marshmallows", "Fish", "Thneeds"], answer: "Truffula Fruits" },
        { qEn: "What is the name of Ted's grandmother?", qKo: "í…Œë“œì˜ í• ë¨¸ë‹ˆ ì´ë¦„ì€?", options: ["Grammy Norma", "Aunt Grizelda", "Wiggins", "Nana"], answer: "Grammy Norma" },
        { qEn: "What did the Lorax leave behind?", qKo: "ë¡œë ‰ìŠ¤ê°€ ë– ë‚˜ë©° ë‚¨ê¸´ ë‹¨ì–´ëŠ”?", options: ["UNLESS", "STOP", "TREES", "SORRY"], answer: "UNLESS" },
        { qEn: "How much did the story cost?", qKo: "ì´ì•¼ê¸°ë¥¼ ë“£ê¸° ìœ„í•œ ë¹„ìš©ì€?", options: ["15 cents, nail, snail", "10 dollars", "A Thneed", "Nothing"], answer: "15 cents, nail, snail" },
        { qEn: "What does 'UNLESS' mean?", qKo: "'UNLESS'ì˜ ì˜ë¯¸ëŠ”?", options: ["Someone must care", "It's too late", "Keep cutting", "Don't cry"], answer: "Someone must care" },
        { qEn: "Who helps Ted escape the town?", qKo: "í…Œë“œì˜ íƒˆì¶œì„ ë•ëŠ” ê°€ì¡±ì€?", options: ["Grammy Norma", "His Mother", "His Sister", "His Father"], answer: "Grammy Norma" },
        { qEn: "What did Ted plant at the end?", qKo: "ë§ˆì§€ë§‰ì— í…Œë“œê°€ ì‹¬ì€ ê²ƒì€?", options: ["The last seed", "A plastic tree", "A flower", "A Thneed"], answer: "The last seed" },
        { qEn: "Who returns at the very end?", qKo: "ë§ˆì§€ë§‰ì— ë‹¤ì‹œ ëŒì•„ì˜¨ ì´ëŠ”?", options: ["The Lorax", "O'Hare", "Ted's Dad", "Audrey"], answer: "The Lorax" },
        { qEn: "Is the air in Thneedville free?", qKo: "ìŠ¤ë‹ˆë“œë¹Œì˜ ê³µê¸°ëŠ” ë¬´ë£Œì¸ê°€ìš”?", options: ["No, it's paid", "Yes, it's free", "It's natural", "No air exists"], answer: "No, it's paid" }
    ];

    let currentIdx = 0;
    let timerInterval;
    let seconds = 0;
    let nickname = "";
    let mode = "EN";

    function showGlobalRank() {
        document.getElementById('rank-modal').classList.remove('hidden');
        window.loadLeaderboard();
    }

    function closeRank() {
        document.getElementById('rank-modal').classList.add('hidden');
    }

    function startGame() {
        nickname = document.getElementById('nickname-input').value.trim();
        mode = document.getElementById('language-mode').value;
        if (!nickname) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”!");
        
        document.getElementById('display-name').innerText = nickname;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        
        timerInterval = setInterval(() => {
            seconds++;
            document.getElementById('timer').innerText = seconds;
        }, 1000);
        
        showQuestion();
    }

    function showQuestion() {
        if (currentIdx >= questions.length) return endGame();
        const q = questions[currentIdx];
        const container = document.getElementById('options-container');
        container.innerHTML = "";
        
        // ëª¨ë“œì— ë”°ë¼ í…ìŠ¤íŠ¸ ë°°ì¹˜ ë³€ê²½
        if (mode === "EN") {
            document.getElementById('question-text').innerHTML = `<strong>${q.qEn}</strong><br><small style="color:gray;">${q.qKo}</small>`;
        } else {
            document.getElementById('question-text').innerHTML = `<strong>${q.qKo}</strong><br><small style="color:gray;">${q.qEn}</small>`;
        }
        
        const shuffled = [...q.options].sort(() => Math.random() - 0.5);
        shuffled.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, q.answer);
            container.appendChild(btn);
        });
    }

    function checkAnswer(selected, correct) {
        if (selected === correct) {
            currentIdx++;
            showQuestion();
        } else {
            const btns = document.querySelectorAll('#options-container button');
            btns.forEach(b => b.disabled = true);
            let timeLeft = 10;
            const msg = document.getElementById('penalty-msg');
            const pInterval = setInterval(() => {
                msg.innerText = `âŒ ì˜¤ë‹µ! ${timeLeft}ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„ ê°€ëŠ¥`;
                timeLeft--;
                if (timeLeft < 0) {
                    clearInterval(pInterval);
                    msg.innerText = "";
                    btns.forEach(b => b.disabled = false);
                }
            }, 1000);
        }
    }

    async function endGame() {
        clearInterval(timerInterval);
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-time').innerText = seconds;
        
        await window.saveScore(nickname, seconds);
        await window.loadLeaderboard();
    }
</script>
</body>
</html>
